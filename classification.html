<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Maximilian Joas" />

<meta name="date" content="2020-04-03" />

<title>Final Report Statistics for Biology 2</title>

<script src="classification_files/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="classification_files/bootstrap-3.3.5/css/cerulean.min.css" rel="stylesheet" />
<script src="classification_files/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="classification_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="classification_files/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="classification_files/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="classification_files/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="classification_files/tocify-1.9.1/jquery.tocify.js"></script>
<script src="classification_files/navigation-1.1/tabsets.js"></script>
<script src="classification_files/navigation-1.1/codefolding.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  { color: #cccccc; background-color: #303030; }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ffcfaf; } /* Alert */
code span.an { color: #7f9f7f; font-weight: bold; } /* Annotation */
code span.at { } /* Attribute */
code span.bn { color: #dca3a3; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #f0dfaf; } /* ControlFlow */
code span.ch { color: #dca3a3; } /* Char */
code span.cn { color: #dca3a3; font-weight: bold; } /* Constant */
code span.co { color: #7f9f7f; } /* Comment */
code span.cv { color: #7f9f7f; font-weight: bold; } /* CommentVar */
code span.do { color: #7f9f7f; } /* Documentation */
code span.dt { color: #dfdfbf; } /* DataType */
code span.dv { color: #dcdccc; } /* DecVal */
code span.er { color: #c3bf9f; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #c0bed1; } /* Float */
code span.fu { color: #efef8f; } /* Function */
code span.im { } /* Import */
code span.in { color: #7f9f7f; font-weight: bold; } /* Information */
code span.kw { color: #f0dfaf; } /* Keyword */
code span.op { color: #f0efd0; } /* Operator */
code span.ot { color: #efef8f; } /* Other */
code span.pp { color: #ffcfaf; font-weight: bold; } /* Preprocessor */
code span.sc { color: #dca3a3; } /* SpecialChar */
code span.ss { color: #cc9393; } /* SpecialString */
code span.st { color: #cc9393; } /* String */
code span.va { } /* Variable */
code span.vs { color: #cc9393; } /* VerbatimString */
code span.wa { color: #7f9f7f; font-weight: bold; } /* Warning */

.sourceCode .row {
  width: 100%;
}
.sourceCode {
  overflow-x: auto;
}
.code-folding-btn {
  margin-right: -30px;
}
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>



<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Final Report Statistics for Biology 2</h1>
<h3 class="subtitle">Random Forest and SVM for Cancer Classification</h3>
<h4 class="author">Maximilian Joas</h4>
<h4 class="date">2020-04-03</h4>

</div>


<div id="data-loading-and-preparation" class="section level2">
<h2>Data Loading and Preparation</h2>
<p>I will not go into detail in this part, since it is basiacally the same code that we did together in class. I will only comment on things that I have changed in comparison to the work in class. The main difference in this section is that I registered a prallel backend for multithreading and that I stored the class Variable “sample.labels” in an extra variable to make the code more reusable in case we use a different dataset where the class variable has another name, we just need to change this variable once.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">library</span>(knitr)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw">library</span>(gdata)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="kw">library</span>(ranger)</a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="kw">library</span>(caret)</a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="kw">library</span>(foreach)</a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="kw">library</span>(doMC)</a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="kw">library</span>(e1071)</a>
<a class="sourceLine" id="cb1-8" data-line-number="8"><span class="kw">library</span>(pROC)</a>
<a class="sourceLine" id="cb1-9" data-line-number="9"></a>
<a class="sourceLine" id="cb1-10" data-line-number="10"><span class="co">## register a paralell backend and define number of Threads</span></a>
<a class="sourceLine" id="cb1-11" data-line-number="11"><span class="co">## Note the the numberThreads variable gets passed later to the ranger function</span></a>
<a class="sourceLine" id="cb1-12" data-line-number="12"><span class="co">## this is neccessary, because ranger uses all available threads as a default and I </span></a>
<a class="sourceLine" id="cb1-13" data-line-number="13"><span class="co">## did not intend to overload the cluster.</span></a>
<a class="sourceLine" id="cb1-14" data-line-number="14">numberThreads &lt;-<span class="st"> </span><span class="dv">4</span></a>
<a class="sourceLine" id="cb1-15" data-line-number="15">doMC<span class="op">::</span><span class="kw">registerDoMC</span>(<span class="dv">8</span>)</a>
<a class="sourceLine" id="cb1-16" data-line-number="16"></a>
<a class="sourceLine" id="cb1-17" data-line-number="17"></a>
<a class="sourceLine" id="cb1-18" data-line-number="18"><span class="co">####  Define Local directories and files ####</span></a>
<a class="sourceLine" id="cb1-19" data-line-number="19"><span class="co">## Find the home directory</span></a>
<a class="sourceLine" id="cb1-20" data-line-number="20">myHome &lt;-<span class="st"> </span><span class="kw">Sys.getenv</span>(<span class="st">&quot;HOME&quot;</span>)</a>
<a class="sourceLine" id="cb1-21" data-line-number="21"></a>
<a class="sourceLine" id="cb1-22" data-line-number="22"><span class="co">## Define the main directory for the  data and results</span></a>
<a class="sourceLine" id="cb1-23" data-line-number="23">mainDir &lt;-<span class="st"> </span><span class="kw">file.path</span>(myHome, <span class="st">&quot;uni/4_sem/biostatistics/report&quot;</span>)</a>
<a class="sourceLine" id="cb1-24" data-line-number="24"><span class="kw">dir.create</span>(<span class="dt">path =</span> mainDir, <span class="dt">showWarnings =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb1-25" data-line-number="25"><span class="kw">message</span>(<span class="st">&quot;Main dir: &quot;</span>, mainDir)</a>
<a class="sourceLine" id="cb1-26" data-line-number="26"></a>
<a class="sourceLine" id="cb1-27" data-line-number="27"><span class="co">## Define a file where we wills store the memory image</span></a>
<a class="sourceLine" id="cb1-28" data-line-number="28">memImageFile &lt;-<span class="st"> </span><span class="kw">file.path</span>(mainDir, <span class="st">&quot;DenBoerData_loaded.Rdata&quot;</span>)</a>
<a class="sourceLine" id="cb1-29" data-line-number="29"></a>
<a class="sourceLine" id="cb1-30" data-line-number="30"><span class="co">## Define the dir where we will download the data</span></a>
<a class="sourceLine" id="cb1-31" data-line-number="31">destDir &lt;-<span class="st"> </span><span class="kw">file.path</span>(mainDir, <span class="st">&quot;data&quot;</span>)</a>
<a class="sourceLine" id="cb1-32" data-line-number="32"><span class="kw">message</span>(<span class="st">&quot;Local data dir: &quot;</span>, destDir)</a>
<a class="sourceLine" id="cb1-33" data-line-number="33"></a>
<a class="sourceLine" id="cb1-34" data-line-number="34"><span class="co">## Define a file where we will store all results</span></a>
<a class="sourceLine" id="cb1-35" data-line-number="35">resultDir &lt;-<span class="st"> </span><span class="kw">file.path</span>(mainDir, <span class="st">&quot;resultDir&quot;</span>)</a>
<a class="sourceLine" id="cb1-36" data-line-number="36"><span class="kw">message</span>(<span class="st">&quot;Result direcotry&quot;</span>, resultDir)</a>
<a class="sourceLine" id="cb1-37" data-line-number="37"></a>
<a class="sourceLine" id="cb1-38" data-line-number="38"></a>
<a class="sourceLine" id="cb1-39" data-line-number="39"><span class="co">#### Define variables for the location and name of the input files ####</span></a>
<a class="sourceLine" id="cb1-40" data-line-number="40"><span class="co">## URL fo the folder containing the data fle</span></a>
<a class="sourceLine" id="cb1-41" data-line-number="41"><span class="co">## Maybe refactor and pass via command line arguments later</span></a>
<a class="sourceLine" id="cb1-42" data-line-number="42">dataURL &lt;-<span class="st"> &quot;https://github.com/jvanheld/stat1/raw/master/data/DenBoer_2009/&quot;</span></a>
<a class="sourceLine" id="cb1-43" data-line-number="43"></a>
<a class="sourceLine" id="cb1-44" data-line-number="44">files &lt;-<span class="st"> </span><span class="kw">c</span>(</a>
<a class="sourceLine" id="cb1-45" data-line-number="45">  <span class="dt">expr =</span> <span class="st">&quot;GSE13425_Norm_Whole.tsv.gz&quot;</span>,</a>
<a class="sourceLine" id="cb1-46" data-line-number="46">  <span class="dt">pheno =</span> <span class="st">&quot;phenoData_GSE13425.tsv.gz&quot;</span>,</a>
<a class="sourceLine" id="cb1-47" data-line-number="47">  <span class="dt">groups =</span> <span class="st">&quot;GSE13425_group_descriptions.tsv.gz&quot;</span></a>
<a class="sourceLine" id="cb1-48" data-line-number="48">)</a>
<a class="sourceLine" id="cb1-49" data-line-number="49"></a>
<a class="sourceLine" id="cb1-50" data-line-number="50"></a>
<a class="sourceLine" id="cb1-51" data-line-number="51"></a>
<a class="sourceLine" id="cb1-52" data-line-number="52"><span class="co">## Function that downloads input files in case they don&quot;t exist locally yet</span></a>
<a class="sourceLine" id="cb1-53" data-line-number="53">DownloadMyFiles &lt;-<span class="st"> </span><span class="cf">function</span>(files,</a>
<a class="sourceLine" id="cb1-54" data-line-number="54">                            dataURL,</a>
<a class="sourceLine" id="cb1-55" data-line-number="55">                            destDir) {</a>
<a class="sourceLine" id="cb1-56" data-line-number="56"></a>
<a class="sourceLine" id="cb1-57" data-line-number="57">  <span class="co">## Create local directory</span></a>
<a class="sourceLine" id="cb1-58" data-line-number="58">  <span class="kw">dir.create</span>(destDir, <span class="dt">recursive =</span> <span class="ot">TRUE</span>, <span class="dt">showWarnings =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb1-59" data-line-number="59"></a>
<a class="sourceLine" id="cb1-60" data-line-number="60">  <span class="cf">for</span> (f <span class="cf">in</span> files) {</a>
<a class="sourceLine" id="cb1-61" data-line-number="61"></a>
<a class="sourceLine" id="cb1-62" data-line-number="62">    <span class="co">## Destination file</span></a>
<a class="sourceLine" id="cb1-63" data-line-number="63">    destFile &lt;-<span class="st"> </span><span class="kw">file.path</span>(destDir, f)</a>
<a class="sourceLine" id="cb1-64" data-line-number="64"></a>
<a class="sourceLine" id="cb1-65" data-line-number="65">    <span class="co">## Check if file exists</span></a>
<a class="sourceLine" id="cb1-66" data-line-number="66">    <span class="cf">if</span> (<span class="kw">file.exists</span>(destFile)) {</a>
<a class="sourceLine" id="cb1-67" data-line-number="67">      <span class="kw">message</span>(<span class="st">&quot;skipping download because file exists: </span><span class="ch">\n</span><span class="st">&quot;</span>, destFile)</a>
<a class="sourceLine" id="cb1-68" data-line-number="68">    } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb1-69" data-line-number="69">      sourceURL &lt;-<span class="st"> </span><span class="kw">file.path</span>(dataURL, f)</a>
<a class="sourceLine" id="cb1-70" data-line-number="70">      <span class="kw">download.file</span>(<span class="dt">url =</span> sourceURL, <span class="dt">destfile =</span> destFile)</a>
<a class="sourceLine" id="cb1-71" data-line-number="71">    }</a>
<a class="sourceLine" id="cb1-72" data-line-number="72">  }</a>
<a class="sourceLine" id="cb1-73" data-line-number="73">}</a>
<a class="sourceLine" id="cb1-74" data-line-number="74"></a>
<a class="sourceLine" id="cb1-75" data-line-number="75"></a>
<a class="sourceLine" id="cb1-76" data-line-number="76"></a>
<a class="sourceLine" id="cb1-77" data-line-number="77"></a>
<a class="sourceLine" id="cb1-78" data-line-number="78"><span class="co">## Call the function to download the files</span></a>
<a class="sourceLine" id="cb1-79" data-line-number="79"><span class="kw">DownloadMyFiles</span>(<span class="dt">files =</span> files, <span class="dt">dataURL =</span> dataURL, <span class="dt">destDir =</span> destDir)</a>
<a class="sourceLine" id="cb1-80" data-line-number="80"></a>
<a class="sourceLine" id="cb1-81" data-line-number="81"><span class="kw">kable</span>(<span class="kw">data.frame</span>(<span class="kw">list.files</span>(destDir)),</a>
<a class="sourceLine" id="cb1-82" data-line-number="82">      <span class="dt">caption =</span> <span class="st">&quot;Content of the destination directory after file download. &quot;</span>)</a></code></pre></div>
<table>
<caption>Content of the destination directory after file download.</caption>
<thead>
<tr class="header">
<th align="left">list.files.destDir.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">GSE13425_group_descriptions.tsv.gz</td>
</tr>
<tr class="even">
<td align="left">GSE13425_Norm_Whole.tsv.gz</td>
</tr>
<tr class="odd">
<td align="left">phenoData_GSE13425.tsv.gz</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="co">## ---------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="co">#### Load data tables ####</span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3"></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="co">## Load expression table</span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5">exprTable &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="kw">file.path</span>(destDir, files[<span class="st">&quot;expr&quot;</span>]),</a>
<a class="sourceLine" id="cb2-6" data-line-number="6">                        <span class="dt">sep =</span> <span class="st">&quot;</span><span class="ch">\t</span><span class="st">&quot;</span>,</a>
<a class="sourceLine" id="cb2-7" data-line-number="7">                        <span class="dt">header =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb2-8" data-line-number="8">                        <span class="dt">quote =</span> <span class="st">&quot;&quot;</span>,</a>
<a class="sourceLine" id="cb2-9" data-line-number="9">                        <span class="dt">row.names =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb2-10" data-line-number="10"><span class="kw">dim</span>(exprTable)</a></code></pre></div>
<pre><code>[1] 22283   190</code></pre>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw">head</span>(exprTable)</a></code></pre></div>
<pre><code>                 GSM338666 GSM338667 GSM338668 GSM338669 GSM338670 GSM338671 GSM338672 GSM338673 GSM338674 GSM338675 GSM338676 GSM338677 GSM338678 GSM338679 GSM338680 GSM338681 GSM338682 GSM338683 GSM338684 GSM338685 GSM338686 GSM338687 GSM338688 GSM338689 GSM338690 GSM338691 GSM338692 GSM338693
DDR1|1007_s_at        4.38      4.38      4.23      3.98      5.12      3.90      4.18      4.23      4.20      4.21      4.16      4.78      4.37      4.24      4.19      4.44      4.15      3.98      3.84      4.32      4.11      4.20      4.04      4.17      4.41      3.98      4.12      3.80
RFC2|1053_at          3.44      3.33      3.73      3.58      3.40      3.07      3.02      3.37      2.97      3.22      3.20      3.04      3.80      3.13      3.39      3.14      3.09      3.35      3.35      3.69      3.97      3.04      3.25      4.20      3.04      3.10      3.29      3.47
HSPA6|117_at          2.51      2.62      2.37      2.43      2.49      2.57      2.69      2.74      2.40      2.59      2.81      2.70      2.70      2.39      3.48      2.50      2.27      2.42      2.69      2.33      2.33      2.27      2.42      2.14      2.75      3.73      2.42      2.23
PAX8|121_at           6.24      6.21      6.10      6.09      6.53      6.18      6.58      6.12      6.02      6.14      6.01      6.38      6.03      6.22      6.07      6.08      6.04      5.99      6.12      6.17      5.94      6.07      5.97      5.83      6.21      6.06      6.21      5.81
GUCA1A|1255_g_at      2.29      2.23      2.17      2.26      2.27      2.18      2.15      2.11      2.21      2.40      2.06      2.17      2.21      2.06      2.10      2.13      2.09      2.15      2.15      2.23      1.97      2.08      2.19      2.10      2.24      2.27      2.25      2.09
                 GSM338694 GSM338695 GSM338696 GSM338697 GSM338698 GSM338699 GSM338700 GSM338701 GSM338702 GSM338703 GSM338704 GSM338705 GSM338706 GSM338707 GSM338708 GSM338709 GSM338710 GSM338711 GSM338712 GSM338713 GSM338714 GSM338715 GSM338716 GSM338717 GSM338718 GSM338719 GSM338720 GSM338721
DDR1|1007_s_at        4.16      3.96      4.21      4.52      3.68      3.79      4.66      3.96      4.27      5.12      4.73      4.83      5.04      4.30      4.52      4.46      4.26      5.64      4.26      5.00      4.20      4.44      4.21      4.83      4.67      4.97      3.88      4.19
RFC2|1053_at          3.42      3.45      3.30      3.31      3.94      3.28      3.14      3.83      3.28      3.10      3.23      3.03      3.27      2.95      3.01      2.81      2.88      3.13      3.22      2.96      3.18      2.92      3.30      2.91      2.80      2.99      3.09      2.79
HSPA6|117_at          3.49      4.42      2.35      2.42      2.50      2.51      4.25      6.22      2.48      2.60      2.25      2.37      2.52      2.98      7.00      2.68      2.92      2.72      4.02      2.40      2.44      2.73      2.40      3.44      4.47      2.65      3.01      2.73
PAX8|121_at           5.87      6.42      6.17      6.23      5.77      5.79      6.09      5.92      6.26      6.45      6.29      6.12      6.31      6.04      6.05      6.02      6.24      6.31      6.02      5.90      5.95      6.22      6.05      6.18      6.31      6.22      6.19      6.11
GUCA1A|1255_g_at      2.16      2.29      2.20      2.17      2.21      2.14      2.27      2.07      2.06      2.35      2.12      2.14      2.16      2.05      2.11      2.10      2.17      2.30      2.18      2.28      2.19      2.24      1.92      2.22      2.19      2.15      2.28      2.08
                 GSM338722 GSM338723 GSM338724 GSM338725 GSM338726 GSM338727 GSM338728 GSM338729 GSM338730 GSM338731 GSM338732 GSM338733 GSM338734 GSM338735 GSM338736 GSM338737 GSM338738 GSM338739 GSM338740 GSM338741 GSM338742 GSM338743 GSM338744 GSM338745 GSM338746 GSM338747 GSM338748 GSM338749
DDR1|1007_s_at        4.45      5.17      5.17      4.71      4.22      4.67      4.77      4.36      4.33      4.91      4.40      4.29      4.29      4.64      4.51      4.25      5.37      4.38      4.49      4.76      4.34      4.89      4.36      4.26      5.40      4.45      4.97      4.56
RFC2|1053_at          3.17      3.00      2.90      2.94      3.38      2.76      3.04      3.08      2.79      3.02      2.83      3.17      2.92      3.01      3.13      3.07      2.91      3.41      3.13      3.25      3.57      3.22      3.22      3.04      3.84      2.98      2.93      3.56
HSPA6|117_at          2.53      2.66      3.01      2.36      2.42      2.50      2.44      2.68      2.46      2.74      2.39      2.68      2.80      2.77      2.40      2.33      2.53      2.58      5.59      2.67      2.30      2.48      2.65      2.80      2.29      2.44      2.43      2.55
PAX8|121_at           6.30      6.48      6.23      6.33      6.00      6.29      6.00      6.08      6.00      6.22      6.15      6.28      6.41      6.16      5.78      5.91      6.05      6.00      5.86      6.14      6.06      6.30      6.09      6.22      6.19      6.24      6.29      6.14
GUCA1A|1255_g_at      2.18      2.16      2.15      2.30      2.23      2.30      2.28      2.11      2.25      2.20      2.23      2.15      2.32      2.23      2.12      2.13      2.32      2.24      2.19      2.12      2.14      2.07      2.15      2.14      2.10      2.17      2.21      2.11
                 GSM338750 GSM338751 GSM338752 GSM338753 GSM338754 GSM338755 GSM338756 GSM338757 GSM338758 GSM338759 GSM338760 GSM338761 GSM338762 GSM338763 GSM338764 GSM338765 GSM338766 GSM338767 GSM338768 GSM338769 GSM338770 GSM338771 GSM338772 GSM338773 GSM338774 GSM338775 GSM338776 GSM338777
DDR1|1007_s_at        4.72      5.03      4.68      4.73      4.85      4.89      4.76      4.74      4.98      4.52      4.73      5.23      4.26      4.73      4.87      5.24      4.18      4.66      4.24      4.20      4.55      4.69      5.08      4.82      4.98      4.54      4.31      4.40
RFC2|1053_at          3.24      3.17      3.46      2.95      2.89      2.97      3.22      3.37      3.03      2.98      3.09      3.35      3.00      2.88      3.03      3.37      3.06      2.94      3.16      3.27      2.94      2.84      3.06      2.98      3.13      2.95      3.08      3.12
HSPA6|117_at          2.71      2.44      2.37      2.53      3.13      2.73      2.77      2.45      2.84      2.93      2.33      2.50      2.70      2.60      2.57      2.74      2.43      2.64      2.61      2.50      2.56      2.50      2.58      2.38      2.43      2.45      2.33      2.38
PAX8|121_at           6.17      6.35      6.02      6.33      5.94      5.87      6.06      6.54      6.26      5.97      6.08      6.26      6.00      6.30      6.28      6.11      6.12      5.99      6.27      6.41      6.31      6.15      6.38      6.13      5.95      6.23      5.96      6.07
GUCA1A|1255_g_at      2.14      2.21      2.03      2.04      2.02      2.20      2.17      2.21      2.29      2.28      2.23      2.09      2.34      2.21      2.21      2.10      2.27      2.11      2.31      2.11      2.20      2.09      2.11      2.12      2.13      2.08      2.12      2.14
                 GSM338778 GSM338779 GSM338780 GSM338781 GSM338782 GSM338783 GSM338784 GSM338785 GSM338786 GSM338787 GSM338788 GSM338789 GSM338790 GSM338791 GSM338792 GSM338793 GSM338794 GSM338795 GSM338796 GSM338797 GSM338798 GSM338799 GSM338800 GSM338801 GSM338802 GSM338803 GSM338804 GSM338805
DDR1|1007_s_at        4.96      4.83      4.69      4.50      4.58      4.37      4.72      4.41      4.64      4.41      4.51      4.27      4.77      4.66      4.43      5.31      5.26      5.47      4.44      4.94      4.61      4.88      4.64      5.44      4.21      4.59      4.69      4.86
RFC2|1053_at          3.14      3.10      3.08      3.06      3.13      2.97      3.19      3.24      3.09      3.39      3.24      3.38      2.90      2.95      3.19      2.94      3.54      2.96      3.15      3.21      3.14      2.95      3.38      3.07      3.21      2.66      3.55      3.33
HSPA6|117_at          2.66      2.41      2.46      2.66      2.88      2.55      2.56      2.30      2.43      2.59      2.71      2.76      2.54      2.75      3.13      2.81      2.54      2.99      2.59      2.89      2.42      2.50      2.17      2.51      2.68      2.59      2.47      2.69
PAX8|121_at           6.40      6.06      6.22      6.25      6.03      6.12      6.20      5.98      6.12      6.14      5.93      6.25      6.46      6.38      6.21      6.37      6.17      6.23      6.24      6.15      6.09      6.25      6.34      6.50      6.17      6.15      5.99      6.32
GUCA1A|1255_g_at      2.33      2.08      2.21      2.18      2.04      2.15      2.22      2.10      2.14      2.34      2.11      2.21      2.21      2.32      2.13      2.12      2.23      2.16      2.05      2.22      2.10      2.25      2.22      2.23      2.10      2.13      2.02      2.26
                 GSM338806 GSM338807 GSM338808 GSM338809 GSM338810 GSM338811 GSM338812 GSM338813 GSM338814 GSM338815 GSM338816 GSM338817 GSM338818 GSM338819 GSM338820 GSM338821 GSM338822 GSM338823 GSM338824 GSM338825 GSM338826 GSM338827 GSM338828 GSM338829 GSM338830 GSM338831 GSM338832 GSM338833
DDR1|1007_s_at        3.67      5.05      5.33      3.98      3.83      3.95      5.13      5.00      4.80      4.08      5.12      3.99      4.22      4.29      5.41      4.71      5.01      4.74      4.58      4.53      4.14      5.40      4.77      4.94      4.28      4.18      4.33      4.25
RFC2|1053_at          3.04      3.23      3.27      3.30      3.22      2.98      3.34      3.32      2.98      3.24      3.31      3.50      3.23      3.24      3.00      3.38      3.14      3.23      3.28      3.39      3.31      2.91      3.79      2.93      3.26      2.81      3.16      3.26
HSPA6|117_at          3.37      7.38      2.47      2.67      2.48      2.76      2.80      2.31      2.44      2.55      2.39      3.41      2.55      3.13      2.37      2.49      2.57      2.67      2.48      2.48      2.75      2.31      2.55      3.14      2.87      2.60      2.58      2.76
PAX8|121_at           6.12      6.18      6.14      6.28      6.02      6.41      6.21      6.31      6.44      6.09      6.03      5.81      6.32      6.02      6.40      5.92      6.36      6.47      6.08      6.13      5.85      5.84      6.08      6.31      6.38      6.37      5.98      6.22
GUCA1A|1255_g_at      2.11      2.10      2.32      2.33      2.21      2.14      2.33      2.04      2.26      2.14      2.27      2.00      2.20      2.11      2.19      2.03      2.18      2.25      2.12      2.01      2.36      2.18      2.14      2.17      2.33      2.43      2.15      2.29
                 GSM338834 GSM338835 GSM338836 GSM338837 GSM338838 GSM338839 GSM338840 GSM338841 GSM338842 GSM338843 GSM338844 GSM338845 GSM338846 GSM338847 GSM338848 GSM338849 GSM338850 GSM338851 GSM338852 GSM338853 GSM338854 GSM338855
DDR1|1007_s_at        4.27      4.61      4.69      4.24      4.24      4.48      5.50      4.64      4.08      4.28      5.03      5.13      4.47      4.88      5.73      5.55      4.15      6.16      4.23      5.18      4.68      4.55
RFC2|1053_at          2.97      2.79      3.09      2.88      3.21      3.19      3.59      3.03      3.18      3.03      2.83      3.07      2.90      3.40      3.04      2.88      2.88      2.89      3.34      3.02      3.07      2.99
HSPA6|117_at          2.57      2.55      2.64      2.70      2.72      2.59      2.46      2.72      3.08      2.34      2.60      2.51      2.61      2.31      2.48      2.68      4.09      2.65      2.83      2.66      2.54      2.64
PAX8|121_at           6.19      6.21      6.09      6.11      6.24      6.20      6.47      6.16      5.90      6.16      6.04      6.12      6.21      6.01      6.20      6.34      6.39      6.25      6.05      6.30      6.38      6.25
GUCA1A|1255_g_at      2.19      2.17      2.13      2.20      2.20      2.13      2.14      2.17      2.11      2.12      2.37      2.07      2.36      2.06      2.14      2.24      2.27      2.27      2.25      2.14      2.23      2.16
 [ reached getOption(&quot;max.print&quot;) -- omitted 1 row ]</code></pre>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="co">## Load metadescriptions (pheno table)</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2">phenoTable &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="kw">file.path</span>(destDir, files[<span class="st">&quot;pheno&quot;</span>]),</a>
<a class="sourceLine" id="cb6-3" data-line-number="3">                         <span class="dt">sep =</span> <span class="st">&quot;</span><span class="ch">\t</span><span class="st">&quot;</span>,</a>
<a class="sourceLine" id="cb6-4" data-line-number="4">                         <span class="dt">header =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb6-5" data-line-number="5">                         <span class="dt">quote =</span> <span class="st">&quot;&quot;</span>,</a>
<a class="sourceLine" id="cb6-6" data-line-number="6">                         <span class="dt">row.names =</span> <span class="dv">1</span></a>
<a class="sourceLine" id="cb6-7" data-line-number="7">                         )</a>
<a class="sourceLine" id="cb6-8" data-line-number="8"><span class="kw">head</span>(phenoTable)</a></code></pre></div>
<pre><code>          Sample.title                                                              Sample.source.name.ch1 Sample.characteristics.ch1             Sample.description sample.labels sample.colors
GSM338666        T-ALL bone marrow or peripheral blood sample from child with acute lymphoblastic leukemia                      T-ALL Sample collected at diagnosis.             T     darkgreen
GSM338667        T-ALL bone marrow or peripheral blood sample from child with acute lymphoblastic leukemia                      T-ALL Sample collected at diagnosis.             T     darkgreen
GSM338668        T-ALL bone marrow or peripheral blood sample from child with acute lymphoblastic leukemia                      T-ALL Sample collected at diagnosis.             T     darkgreen
GSM338669        T-ALL bone marrow or peripheral blood sample from child with acute lymphoblastic leukemia                      T-ALL Sample collected at diagnosis.             T     darkgreen
GSM338670        T-ALL bone marrow or peripheral blood sample from child with acute lymphoblastic leukemia                      T-ALL Sample collected at diagnosis.             T     darkgreen
GSM338671        T-ALL bone marrow or peripheral blood sample from child with acute lymphoblastic leukemia                      T-ALL Sample collected at diagnosis.             T     darkgreen</code></pre>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="co">## for reusability provide the name of the class variable for this dataset</span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2">classVariable &lt;-<span class="st"> &quot;sample.labels&quot;</span></a>
<a class="sourceLine" id="cb8-3" data-line-number="3"></a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="co">## Load group descriptions</span></a>
<a class="sourceLine" id="cb8-5" data-line-number="5">groupDescriptions &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="kw">file.path</span>(destDir, files[<span class="st">&quot;groups&quot;</span>]),</a>
<a class="sourceLine" id="cb8-6" data-line-number="6">                                <span class="dt">sep =</span> <span class="st">&quot;</span><span class="ch">\t</span><span class="st">&quot;</span>,</a>
<a class="sourceLine" id="cb8-7" data-line-number="7">                                <span class="dt">header =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb8-8" data-line-number="8">                                <span class="dt">quote =</span> <span class="st">&quot;&quot;</span>,</a>
<a class="sourceLine" id="cb8-9" data-line-number="9">                                <span class="dt">row.names =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb8-10" data-line-number="10"><span class="kw">dim</span>(groupDescriptions)</a></code></pre></div>
<pre><code>[1] 11  2</code></pre>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="kw">print</span>(groupDescriptions)</a></code></pre></div>
<pre><code>                         group.labels group.colors
T-ALL                               T    darkgreen
TEL-AML1                           Bt          red
TEL-AML1 + hyperdiploidy          Bth         blue
hyperdiploid                       Bh        brown
E2A-rearranged (E)                 BE        green
E2A-rearranged (EP)               BEp       orange
E2A-rearranged (E-sub)            BEs     darkgray
BCR-ABL                            Bc         cyan
BCR-ABL + hyperdiploidy           Bch        black
MLL                                BM       violet
pre-B ALL                          Bo     darkblue</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="kw">kable</span>(groupDescriptions)</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th></th>
<th align="left">group.labels</th>
<th align="left">group.colors</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>T-ALL</td>
<td align="left">T</td>
<td align="left">darkgreen</td>
</tr>
<tr class="even">
<td>TEL-AML1</td>
<td align="left">Bt</td>
<td align="left">red</td>
</tr>
<tr class="odd">
<td>TEL-AML1 + hyperdiploidy</td>
<td align="left">Bth</td>
<td align="left">blue</td>
</tr>
<tr class="even">
<td>hyperdiploid</td>
<td align="left">Bh</td>
<td align="left">brown</td>
</tr>
<tr class="odd">
<td>E2A-rearranged (E)</td>
<td align="left">BE</td>
<td align="left">green</td>
</tr>
<tr class="even">
<td>E2A-rearranged (EP)</td>
<td align="left">BEp</td>
<td align="left">orange</td>
</tr>
<tr class="odd">
<td>E2A-rearranged (E-sub)</td>
<td align="left">BEs</td>
<td align="left">darkgray</td>
</tr>
<tr class="even">
<td>BCR-ABL</td>
<td align="left">Bc</td>
<td align="left">cyan</td>
</tr>
<tr class="odd">
<td>BCR-ABL + hyperdiploidy</td>
<td align="left">Bch</td>
<td align="left">black</td>
</tr>
<tr class="even">
<td>MLL</td>
<td align="left">BM</td>
<td align="left">violet</td>
</tr>
<tr class="odd">
<td>pre-B ALL</td>
<td align="left">Bo</td>
<td align="left">darkblue</td>
</tr>
</tbody>
</table>
</div>
<div id="prepare-data-specifically-for-the-classification-task" class="section level2">
<h2>Prepare Data specifically for the classification task</h2>
<p>Since I am working with two data tables, one with the gene expression data and one with the pheno data, I check if the patients have the same order in each of the tables. This should be the case, but a mistake here would be crucial. I also transposed the expression table to have all the patient as rows and the gene expression values in columns. This format is required by many packages for classification.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="co">#### Prepare data for classification task ####</span></a>
<a class="sourceLine" id="cb13-2" data-line-number="2"><span class="co">## check if pheno data and expression data have same order of patients</span></a>
<a class="sourceLine" id="cb13-3" data-line-number="3">check &lt;-<span class="st"> </span><span class="kw">colnames</span>(exprTable) <span class="op">==</span><span class="st"> </span><span class="kw">rownames</span>(phenoTable)</a>
<a class="sourceLine" id="cb13-4" data-line-number="4"><span class="kw">message</span>(<span class="st">&quot;Do Pheno and Expressiondata have the same order of patients&quot;</span>)</a>
<a class="sourceLine" id="cb13-5" data-line-number="5"><span class="kw">message</span>(<span class="kw">all</span>(<span class="dt">check =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb13-6" data-line-number="6"></a>
<a class="sourceLine" id="cb13-7" data-line-number="7"><span class="co">## Transposing the exprTable do that it has the right format for the package</span></a>
<a class="sourceLine" id="cb13-8" data-line-number="8">exprTableTransposed &lt;-<span class="st"> </span><span class="kw">t</span>(exprTable)</a>
<a class="sourceLine" id="cb13-9" data-line-number="9"></a>
<a class="sourceLine" id="cb13-10" data-line-number="10"><span class="co">## this prevents an error in the ranger function due to ilegal names</span></a>
<a class="sourceLine" id="cb13-11" data-line-number="11"><span class="kw">colnames</span>(exprTableTransposed) &lt;-<span class="st"> </span><span class="kw">make.names</span>(<span class="kw">colnames</span>(exprTableTransposed))</a></code></pre></div>
</div>
<div id="functions-for-feature-selection-and-classification" class="section level2">
<h2>Functions for Feature Selection and Classification</h2>
<p>I order to have as many training and test patients as possible I decided to use leave one out cross validation as an approach. The standard way to do this would be to use the caret packages. I decided, however, to implement the functionality myself. The reason for this is that I also wanted to use the LOOCV approach for feature selection to avoid any bias. With my own implementation I could be sure that I used the exact same method for feature selection and the training of the model. For my Implementation I used the foreach package for parallelization, which is highly optimized. Thus, my implementation is also highly performant.</p>
<p>My functions are structured as follows: I have one function &quot;SelectFeaturesWithWu</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">FilterClass &lt;-<span class="st"> </span><span class="cf">function</span>(minimumNumberofCases){</a>
<a class="sourceLine" id="cb14-2" data-line-number="2">  releventClasses &lt;-<span class="st"> </span><span class="kw">names</span>(<span class="kw">which</span>(<span class="kw">table</span>(</a>
<a class="sourceLine" id="cb14-3" data-line-number="3">                    phenoTable[, classVariable]) <span class="op">&gt;</span><span class="st"> </span>minimumNumberofCases))</a>
<a class="sourceLine" id="cb14-4" data-line-number="4">   helper &lt;-<span class="st"> </span>phenoTable[, classVariable] <span class="op">%in%</span><span class="st"> </span>releventClasses</a>
<a class="sourceLine" id="cb14-5" data-line-number="5">   phenoTable &lt;-<span class="st"> </span>phenoTable[helper, ]</a>
<a class="sourceLine" id="cb14-6" data-line-number="6">   exprTableTransposed &lt;-<span class="st"> </span>exprTableTransposed[helper, ]</a>
<a class="sourceLine" id="cb14-7" data-line-number="7">}</a>
<a class="sourceLine" id="cb14-8" data-line-number="8"><span class="co">#### Feature Selection ####</span></a>
<a class="sourceLine" id="cb14-9" data-line-number="9"><span class="co">## Function that selects genes based on the random forest variable importance</span></a>
<a class="sourceLine" id="cb14-10" data-line-number="10"><span class="co">## It takes a vector as index variable that indicates which patients should be used</span></a>
<a class="sourceLine" id="cb14-11" data-line-number="11">SelectFeaturesWithRandomForest &lt;-<span class="st"> </span><span class="cf">function</span>(trainIndex,</a>
<a class="sourceLine" id="cb14-12" data-line-number="12">                                           numFeatures,</a>
<a class="sourceLine" id="cb14-13" data-line-number="13">                                           <span class="dt">verbose =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb14-14" data-line-number="14">                                           ) {</a>
<a class="sourceLine" id="cb14-15" data-line-number="15">    <span class="cf">if</span>(verbose) <span class="kw">message</span>(<span class="st">&quot;Fitting a Random Forest for feature selection&quot;</span>)</a>
<a class="sourceLine" id="cb14-16" data-line-number="16">    fit &lt;-<span class="st"> </span><span class="kw">ranger</span>(<span class="dt">y =</span> phenoTable[trainIndex, classVariable],</a>
<a class="sourceLine" id="cb14-17" data-line-number="17">                  <span class="dt">x =</span> exprTableTransposed[trainIndex,],</a>
<a class="sourceLine" id="cb14-18" data-line-number="18">                  <span class="dt">importance =</span> <span class="st">&quot;impurity&quot;</span>,</a>
<a class="sourceLine" id="cb14-19" data-line-number="19">                  <span class="dt">mtry =</span> tunedMtry,</a>
<a class="sourceLine" id="cb14-20" data-line-number="20">                  <span class="dt">num.threads =</span> numberThreads,</a>
<a class="sourceLine" id="cb14-21" data-line-number="21">                  )</a>
<a class="sourceLine" id="cb14-22" data-line-number="22"></a>
<a class="sourceLine" id="cb14-23" data-line-number="23">    <span class="cf">if</span>(verbose) <span class="kw">message</span>(<span class="st">&quot;Finished fitting, now extracting variable importance&quot;</span>)</a>
<a class="sourceLine" id="cb14-24" data-line-number="24">    varImportance &lt;-<span class="st"> </span>fit<span class="op">$</span>variable.importance</a>
<a class="sourceLine" id="cb14-25" data-line-number="25">    selectedGenes &lt;-<span class="st"> </span><span class="kw">sort</span>(varImportance, <span class="dt">na.last =</span> <span class="ot">TRUE</span>, <span class="dt">decreasing =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb14-26" data-line-number="26">    <span class="kw">return</span>(selectedGenes[<span class="dv">1</span><span class="op">:</span>numFeatures])</a>
<a class="sourceLine" id="cb14-27" data-line-number="27">}</a>
<a class="sourceLine" id="cb14-28" data-line-number="28"></a>
<a class="sourceLine" id="cb14-29" data-line-number="29"></a>
<a class="sourceLine" id="cb14-30" data-line-number="30"></a>
<a class="sourceLine" id="cb14-31" data-line-number="31"><span class="co">## Selection with leave one out cross validation</span></a>
<a class="sourceLine" id="cb14-32" data-line-number="32">SelectRandomForestLOOCV &lt;-<span class="st"> </span><span class="cf">function</span>(numFeatures,</a>
<a class="sourceLine" id="cb14-33" data-line-number="33">                                    <span class="dt">verbose =</span> <span class="ot">FALSE</span>) {</a>
<a class="sourceLine" id="cb14-34" data-line-number="34">    res &lt;-<span class="st"> </span><span class="kw">foreach</span>(<span class="dt">i =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(exprTableTransposed)) <span class="op">%dopar%</span><span class="st"> </span>{</a>
<a class="sourceLine" id="cb14-35" data-line-number="35">            curVariables &lt;-<span class="st"> </span><span class="kw">SelectFeaturesWithRandomForest</span>(<span class="op">-</span>i,</a>
<a class="sourceLine" id="cb14-36" data-line-number="36">                                                           numFeatures,</a>
<a class="sourceLine" id="cb14-37" data-line-number="37">                                                           verbose)</a>
<a class="sourceLine" id="cb14-38" data-line-number="38">            <span class="kw">return</span>(curVariables)</a>
<a class="sourceLine" id="cb14-39" data-line-number="39"></a>
<a class="sourceLine" id="cb14-40" data-line-number="40">    }</a>
<a class="sourceLine" id="cb14-41" data-line-number="41">    <span class="kw">names</span>(res) &lt;-<span class="st"> </span><span class="kw">rownames</span>(phenoTable)</a>
<a class="sourceLine" id="cb14-42" data-line-number="42">    <span class="kw">return</span>(res)</a>
<a class="sourceLine" id="cb14-43" data-line-number="43">}</a>
<a class="sourceLine" id="cb14-44" data-line-number="44"></a>
<a class="sourceLine" id="cb14-45" data-line-number="45"></a>
<a class="sourceLine" id="cb14-46" data-line-number="46"></a>
<a class="sourceLine" id="cb14-47" data-line-number="47"><span class="co">## Function that classifies patients with random forest</span></a>
<a class="sourceLine" id="cb14-48" data-line-number="48">RandomForestClassifier &lt;-<span class="st"> </span><span class="cf">function</span>(numberTrees,</a>
<a class="sourceLine" id="cb14-49" data-line-number="49">                                   testIndex,</a>
<a class="sourceLine" id="cb14-50" data-line-number="50">                                   trainIndex,</a>
<a class="sourceLine" id="cb14-51" data-line-number="51">                                   selectedCovariates,</a>
<a class="sourceLine" id="cb14-52" data-line-number="52">                                   <span class="dt">verbose =</span> <span class="ot">TRUE</span>) {</a>
<a class="sourceLine" id="cb14-53" data-line-number="53">    <span class="cf">if</span>(verbose) <span class="kw">message</span>(<span class="st">&quot;Fitting the Random Forest&quot;</span>)</a>
<a class="sourceLine" id="cb14-54" data-line-number="54">    <span class="cf">if</span>(verbose) <span class="kw">message</span>(<span class="kw">paste0</span>(<span class="st">&quot;Using &quot;</span>,numberTrees,<span class="st">&quot; trees&quot;</span>))</a>
<a class="sourceLine" id="cb14-55" data-line-number="55">    rf.fit &lt;-<span class="st"> </span><span class="kw">ranger</span>(<span class="dt">y =</span> phenoTable[trainIndex, classVariable],</a>
<a class="sourceLine" id="cb14-56" data-line-number="56">                     <span class="dt">x =</span> exprTableTransposed[trainIndex, selectedCovariates],</a>
<a class="sourceLine" id="cb14-57" data-line-number="57">                     <span class="dt">num.trees =</span> numberTrees,</a>
<a class="sourceLine" id="cb14-58" data-line-number="58">                     <span class="dt">num.threads =</span> numberThreads,</a>
<a class="sourceLine" id="cb14-59" data-line-number="59">                     <span class="dt">mtry =</span> tunedMtry)</a>
<a class="sourceLine" id="cb14-60" data-line-number="60"></a>
<a class="sourceLine" id="cb14-61" data-line-number="61">    testData &lt;-<span class="st"> </span><span class="kw">t</span>(<span class="kw">as.data.frame</span>(exprTableTransposed[testIndex,</a>
<a class="sourceLine" id="cb14-62" data-line-number="62">                                selectedCovariates]))</a>
<a class="sourceLine" id="cb14-63" data-line-number="63">    <span class="cf">if</span>(<span class="kw">length</span>(testIndex) <span class="op">!=</span><span class="dv">1</span>) {</a>
<a class="sourceLine" id="cb14-64" data-line-number="64">        testData &lt;-<span class="st"> </span>exprTableTransposed[testIndex, selectedCovariates]</a>
<a class="sourceLine" id="cb14-65" data-line-number="65">        }</a>
<a class="sourceLine" id="cb14-66" data-line-number="66">    <span class="cf">if</span>(verbose) <span class="kw">message</span>(<span class="st">&quot;Starting prediction based on the fitted model&quot;</span>)</a>
<a class="sourceLine" id="cb14-67" data-line-number="67">    predicted &lt;-<span class="st"> </span><span class="kw">predict</span>(rf.fit, testData)</a>
<a class="sourceLine" id="cb14-68" data-line-number="68">    <span class="cf">if</span>(verbose) <span class="kw">message</span>(<span class="st">&quot;Finished predicting, now returning the predictions&quot;</span>)</a>
<a class="sourceLine" id="cb14-69" data-line-number="69">    predicted<span class="op">$</span>predictions</a>
<a class="sourceLine" id="cb14-70" data-line-number="70">    <span class="kw">return</span>(predicted<span class="op">$</span>predictions)</a>
<a class="sourceLine" id="cb14-71" data-line-number="71">}</a>
<a class="sourceLine" id="cb14-72" data-line-number="72"></a>
<a class="sourceLine" id="cb14-73" data-line-number="73"></a>
<a class="sourceLine" id="cb14-74" data-line-number="74"><span class="co">## Function that classifies patients with SVM</span></a>
<a class="sourceLine" id="cb14-75" data-line-number="75">SvmClassifier &lt;-<span class="st"> </span><span class="cf">function</span>(myKernel,</a>
<a class="sourceLine" id="cb14-76" data-line-number="76">                          testIndex,</a>
<a class="sourceLine" id="cb14-77" data-line-number="77">                          trainIndex,</a>
<a class="sourceLine" id="cb14-78" data-line-number="78">                          selectedCovariates,</a>
<a class="sourceLine" id="cb14-79" data-line-number="79">                          <span class="dt">verbose =</span> <span class="ot">TRUE</span>) {</a>
<a class="sourceLine" id="cb14-80" data-line-number="80">    <span class="cf">if</span>(verbose) <span class="kw">message</span>(<span class="st">&quot;Starting fitting a SVM Mode&quot;</span>)</a>
<a class="sourceLine" id="cb14-81" data-line-number="81">    svm.fit &lt;-<span class="st"> </span><span class="kw">svm</span>(<span class="dt">y =</span> phenoTable[trainIndex, classVariable],</a>
<a class="sourceLine" id="cb14-82" data-line-number="82">                   <span class="dt">x =</span> exprTableTransposed[trainIndex, selectedCovariates],</a>
<a class="sourceLine" id="cb14-83" data-line-number="83">                   <span class="dt">kernel =</span> myKernel,</a>
<a class="sourceLine" id="cb14-84" data-line-number="84">                   <span class="dt">gamma =</span> <span class="fl">0.1</span>,</a>
<a class="sourceLine" id="cb14-85" data-line-number="85">                   <span class="dt">cost =</span> <span class="dv">10</span>,</a>
<a class="sourceLine" id="cb14-86" data-line-number="86">                   <span class="dt">type =</span> <span class="st">&quot;C-classification&quot;</span>)</a>
<a class="sourceLine" id="cb14-87" data-line-number="87">    <span class="co"># neccessary in case the test index has length one (loocv)</span></a>
<a class="sourceLine" id="cb14-88" data-line-number="88">    testData &lt;-<span class="st"> </span><span class="kw">t</span>(<span class="kw">as.data.frame</span>(exprTableTransposed[testIndex,</a>
<a class="sourceLine" id="cb14-89" data-line-number="89">                                                           selectedCovariates]))</a>
<a class="sourceLine" id="cb14-90" data-line-number="90">    <span class="cf">if</span>(<span class="kw">length</span>(testIndex) <span class="op">!=</span><span class="dv">1</span>) {</a>
<a class="sourceLine" id="cb14-91" data-line-number="91">        testData &lt;-<span class="st"> </span>exprTableTransposed[testIndex, selectedCovariates]</a>
<a class="sourceLine" id="cb14-92" data-line-number="92">    }</a>
<a class="sourceLine" id="cb14-93" data-line-number="93">    predicted &lt;-<span class="st"> </span><span class="kw">predict</span>(svm.fit, <span class="dt">newdata =</span> testData)</a>
<a class="sourceLine" id="cb14-94" data-line-number="94">    <span class="kw">return</span>(predicted)</a>
<a class="sourceLine" id="cb14-95" data-line-number="95">}</a>
<a class="sourceLine" id="cb14-96" data-line-number="96"></a>
<a class="sourceLine" id="cb14-97" data-line-number="97"></a>
<a class="sourceLine" id="cb14-98" data-line-number="98"></a>
<a class="sourceLine" id="cb14-99" data-line-number="99"><span class="co">#### Function for LOOCV ####</span></a>
<a class="sourceLine" id="cb14-100" data-line-number="100"><span class="co">## --------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb14-101" data-line-number="101"></a>
<a class="sourceLine" id="cb14-102" data-line-number="102">LOOCV &lt;-<span class="st"> </span><span class="cf">function</span>(FUN,</a>
<a class="sourceLine" id="cb14-103" data-line-number="103">                  parameter,</a>
<a class="sourceLine" id="cb14-104" data-line-number="104">                  selection,</a>
<a class="sourceLine" id="cb14-105" data-line-number="105">                  <span class="dt">verbose =</span> <span class="ot">FALSE</span>) {</a>
<a class="sourceLine" id="cb14-106" data-line-number="106">    res &lt;-<span class="st"> </span><span class="kw">foreach</span>(<span class="dt">i =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(exprTableTransposed)) <span class="op">%dopar%</span><span class="st"> </span>{</a>
<a class="sourceLine" id="cb14-107" data-line-number="107">        curVariables &lt;-<span class="st"> </span><span class="kw">names</span>(selection[</a>
<a class="sourceLine" id="cb14-108" data-line-number="108">                              <span class="kw">rownames</span>(exprTableTransposed)[i]][[<span class="dv">1</span>]])</a>
<a class="sourceLine" id="cb14-109" data-line-number="109">        trainIndex &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(exprTableTransposed))[<span class="op">-</span>i]</a>
<a class="sourceLine" id="cb14-110" data-line-number="110">        <span class="cf">if</span>(verbose) <span class="kw">message</span>(<span class="st">&quot;Fitting Loocv&quot;</span>)</a>
<a class="sourceLine" id="cb14-111" data-line-number="111">        res &lt;-<span class="st"> </span><span class="kw">FUN</span>(parameter,</a>
<a class="sourceLine" id="cb14-112" data-line-number="112">                   i, <span class="op">-</span>i,</a>
<a class="sourceLine" id="cb14-113" data-line-number="113">                   curVariables,</a>
<a class="sourceLine" id="cb14-114" data-line-number="114">                   verbose)</a>
<a class="sourceLine" id="cb14-115" data-line-number="115">        res &lt;-<span class="st"> </span><span class="kw">droplevels</span>(res)</a>
<a class="sourceLine" id="cb14-116" data-line-number="116">        <span class="kw">names</span>(res) &lt;-<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb14-117" data-line-number="117">        <span class="kw">return</span>(res)</a>
<a class="sourceLine" id="cb14-118" data-line-number="118">    }</a>
<a class="sourceLine" id="cb14-119" data-line-number="119">    <span class="cf">if</span>(verbose) <span class="kw">message</span>(<span class="st">&#39;returning&#39;</span>)</a>
<a class="sourceLine" id="cb14-120" data-line-number="120">    <span class="kw">names</span>(res) &lt;-<span class="st"> </span><span class="kw">rownames</span>(exprTableTransposed)</a>
<a class="sourceLine" id="cb14-121" data-line-number="121">    <span class="kw">return</span>(<span class="kw">unlist</span>(res))</a>
<a class="sourceLine" id="cb14-122" data-line-number="122">}</a></code></pre></div>
</div>
<div id="execution-of-code" class="section level2">
<h2>Execution of code</h2>
<p>TODO</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="co">#### EXECUTION ####</span></a>
<a class="sourceLine" id="cb15-2" data-line-number="2"><span class="co">## --------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb15-3" data-line-number="3"></a>
<a class="sourceLine" id="cb15-4" data-line-number="4"><span class="co">## first we tune the mtry parameter of the random forest model with cared</span></a>
<a class="sourceLine" id="cb15-5" data-line-number="5"><span class="co">## 10 folds repeat 3 times</span></a>
<a class="sourceLine" id="cb15-6" data-line-number="6"></a>
<a class="sourceLine" id="cb15-7" data-line-number="7"><span class="co"># at first we need to perform class filtering</span></a>
<a class="sourceLine" id="cb15-8" data-line-number="8"><span class="kw">FilterClass</span>(<span class="dv">30</span>)</a>
<a class="sourceLine" id="cb15-9" data-line-number="9">control &lt;-<span class="st"> </span><span class="kw">trainControl</span>(<span class="dt">method =</span> <span class="st">&#39;repeatedcv&#39;</span>,</a>
<a class="sourceLine" id="cb15-10" data-line-number="10">                        <span class="dt">number =</span> <span class="dv">10</span>,</a>
<a class="sourceLine" id="cb15-11" data-line-number="11">                        <span class="dt">repeats =</span> <span class="dv">3</span>,</a>
<a class="sourceLine" id="cb15-12" data-line-number="12">                        <span class="dt">search =</span> <span class="st">&#39;random&#39;</span>)</a>
<a class="sourceLine" id="cb15-13" data-line-number="13"><span class="kw">set.seed</span>(<span class="dv">123</span>)</a>
<a class="sourceLine" id="cb15-14" data-line-number="14">rf.random &lt;-<span class="st"> </span><span class="kw">train</span>(<span class="dt">y =</span> phenoTable[,classVariable],</a>
<a class="sourceLine" id="cb15-15" data-line-number="15">                   <span class="dt">x =</span> exprTableTransposed,</a>
<a class="sourceLine" id="cb15-16" data-line-number="16">                   <span class="dt">method =</span> <span class="st">&quot;ranger&quot;</span>,</a>
<a class="sourceLine" id="cb15-17" data-line-number="17">                   <span class="dt">metric =</span> <span class="st">&quot;Accuracy&quot;</span>,</a>
<a class="sourceLine" id="cb15-18" data-line-number="18">                   <span class="dt">trControl =</span> control)</a>
<a class="sourceLine" id="cb15-19" data-line-number="19">tunedMtry &lt;-<span class="st"> </span>rf.random<span class="op">$</span>finalModel<span class="op">$</span>mtry</a>
<a class="sourceLine" id="cb15-20" data-line-number="20">tunedMtryAllFeatures &lt;-<span class="st"> </span>rf.random<span class="op">$</span>finalModel<span class="op">$</span>mtry</a></code></pre></div>
</div>
<div id="feature-selection-execution" class="section level2">
<h2>Feature Selection Execution</h2>
<p>TODO</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="co">## now we select how many covariates we want to select</span></a>
<a class="sourceLine" id="cb16-2" data-line-number="2">x &lt;-<span class="st"> </span><span class="kw">SelectFeaturesWithRandomForest</span>(<span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(exprTableTransposed)),</a>
<a class="sourceLine" id="cb16-3" data-line-number="3">                                    <span class="kw">nrow</span>(exprTableTransposed))</a>
<a class="sourceLine" id="cb16-4" data-line-number="4"><span class="kw">plot</span>(<span class="kw">sort</span>(x, <span class="dt">na.last =</span> <span class="ot">TRUE</span>, <span class="dt">decreasing =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb16-5" data-line-number="5">lo &lt;-<span class="st"> </span><span class="kw">loess</span>(x <span class="op">~</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(exprTableTransposed)))</a>
<a class="sourceLine" id="cb16-6" data-line-number="6">out =<span class="st"> </span><span class="kw">predict</span>(lo)</a>
<a class="sourceLine" id="cb16-7" data-line-number="7">secondDer &lt;-<span class="st"> </span><span class="kw">diff</span>(<span class="kw">diff</span>(out))</a>
<a class="sourceLine" id="cb16-8" data-line-number="8">maximalChangePoint &lt;-<span class="st"> </span><span class="kw">max</span>(secondDer)</a>
<a class="sourceLine" id="cb16-9" data-line-number="9">maximalChangeIndex &lt;-<span class="st"> </span><span class="kw">match</span>(maximalChangePoint, secondDer)</a>
<a class="sourceLine" id="cb16-10" data-line-number="10">pointHelper &lt;-<span class="st"> </span>(<span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(phenoTable) <span class="op">==</span><span class="st"> </span>maximalChangeIndex)</a>
<a class="sourceLine" id="cb16-11" data-line-number="11"><span class="kw">lines</span>(out, <span class="dt">col =</span> <span class="st">&#39;red&#39;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb16-12" data-line-number="12"><span class="kw">abline</span>(<span class="dt">v =</span>maximalChangeIndex)</a>
<a class="sourceLine" id="cb16-13" data-line-number="13"><span class="kw">points</span>(out[pointHelper], <span class="dt">x =</span> maximalChangeIndex, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">pch =</span> <span class="dv">22</span>, <span class="dt">cex =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb16-14" data-line-number="14">numberFeatures &lt;-<span class="st"> </span>maximalChangeIndex</a>
<a class="sourceLine" id="cb16-15" data-line-number="15"></a>
<a class="sourceLine" id="cb16-16" data-line-number="16"></a>
<a class="sourceLine" id="cb16-17" data-line-number="17"></a>
<a class="sourceLine" id="cb16-18" data-line-number="18"><span class="co">## finally we can perform the acutal selection</span></a>
<a class="sourceLine" id="cb16-19" data-line-number="19">loocvSelections &lt;-<span class="st"> </span><span class="kw">SelectRandomForestLOOCV</span>(numberFeatures)</a>
<a class="sourceLine" id="cb16-20" data-line-number="20"><span class="kw">write.csv</span>(loocvSelections, <span class="st">&#39;loocvSelections.csv&#39;</span>)</a></code></pre></div>
</div>
<div id="tune-mtry-after-the-feature-selection" class="section level2">
<h2>Tune Mtry after the Feature Selection</h2>
<p>TOD</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1">control &lt;-<span class="st"> </span><span class="kw">trainControl</span>(<span class="dt">method =</span> <span class="st">&#39;repeatedcv&#39;</span>,</a>
<a class="sourceLine" id="cb17-2" data-line-number="2">                        <span class="dt">number =</span> <span class="dv">10</span>,</a>
<a class="sourceLine" id="cb17-3" data-line-number="3">                        <span class="dt">repeats =</span> <span class="dv">3</span>,</a>
<a class="sourceLine" id="cb17-4" data-line-number="4">                        <span class="dt">search =</span> <span class="st">&#39;random&#39;</span>)</a>
<a class="sourceLine" id="cb17-5" data-line-number="5"><span class="kw">set.seed</span>(<span class="dv">123</span>)</a>
<a class="sourceLine" id="cb17-6" data-line-number="6">rf_random &lt;-<span class="st"> </span><span class="kw">train</span>(<span class="dt">y =</span> phenoTable[,classVariable],</a>
<a class="sourceLine" id="cb17-7" data-line-number="7">                   <span class="dt">x =</span> exprTableTransposed[,<span class="kw">names</span>(x)],</a>
<a class="sourceLine" id="cb17-8" data-line-number="8">                   <span class="dt">method =</span> <span class="st">&quot;ranger&quot;</span>,</a>
<a class="sourceLine" id="cb17-9" data-line-number="9">                   <span class="dt">metric =</span> <span class="st">&quot;Accuracy&quot;</span>,</a>
<a class="sourceLine" id="cb17-10" data-line-number="10">                   <span class="dt">trControl =</span> control)</a>
<a class="sourceLine" id="cb17-11" data-line-number="11">tunedMtryFeatureSelection &lt;-<span class="st"> </span>rf_random<span class="op">$</span>finalModel<span class="op">$</span>mtry</a></code></pre></div>
</div>
<div id="classification-execution" class="section level2">
<h2>Classification Execution</h2>
<p>TODO</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1">numberOfTrees &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">200</span>, <span class="dv">500</span>, <span class="dv">1000</span>)</a>
<a class="sourceLine" id="cb18-2" data-line-number="2">kernels &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;radial&quot;</span>, <span class="st">&quot;linear&quot;</span>, <span class="st">&quot;polynomial&quot;</span>, <span class="st">&quot;sigmoid&quot;</span>)</a>
<a class="sourceLine" id="cb18-3" data-line-number="3">allGenesSelected &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="kw">list</span>(x), <span class="kw">nrow</span>(exprTableTransposed))</a>
<a class="sourceLine" id="cb18-4" data-line-number="4"></a>
<a class="sourceLine" id="cb18-5" data-line-number="5"><span class="kw">names</span>(allGenesSelected) &lt;-<span class="st"> </span><span class="kw">rownames</span>(exprTableTransposed)</a>
<a class="sourceLine" id="cb18-6" data-line-number="6">selections &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">allGenes =</span> allGenesSelected,</a>
<a class="sourceLine" id="cb18-7" data-line-number="7">                   <span class="dt">rfSelection =</span> loocvSelections)</a>
<a class="sourceLine" id="cb18-8" data-line-number="8">resultList &lt;-<span class="st"> </span><span class="kw">foreach</span>(<span class="dt">selection =</span> <span class="kw">names</span>(selections), <span class="dt">.combine =</span> <span class="st">&quot;c&quot;</span>) <span class="op">%do%</span><span class="st"> </span>{</a>
<a class="sourceLine" id="cb18-9" data-line-number="9">    <span class="cf">if</span>(selection <span class="op">==</span><span class="st"> &quot;rfSelection&quot;</span>) tunedMtry =<span class="st"> </span>tunedMtryFeatureSelection <span class="cf">else</span> tunedMtry =<span class="st"> </span><span class="kw">ceiling</span>(<span class="kw">sqrt</span>(<span class="kw">ncol</span>(exprTableTransposed)))</a>
<a class="sourceLine" id="cb18-10" data-line-number="10">    <span class="kw">message</span>(tunedMtry)</a>
<a class="sourceLine" id="cb18-11" data-line-number="11">    selData &lt;-<span class="st"> </span>selections[[selection]]</a>
<a class="sourceLine" id="cb18-12" data-line-number="12">    rf.comb &lt;-<span class="st"> </span><span class="kw">foreach</span>(<span class="dt">numTree =</span> numberOfTrees, <span class="dt">.combine =</span> <span class="st">&quot;c&quot;</span>) <span class="op">%do%</span><span class="st"> </span>{</a>
<a class="sourceLine" id="cb18-13" data-line-number="13">        rf.loocv &lt;-<span class="st"> </span><span class="kw">LOOCV</span>(RandomForestClassifier, numTree, selData)</a>
<a class="sourceLine" id="cb18-14" data-line-number="14">        helperLoocvFile &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;rf_loocv_Selection_&quot;</span>, selection,</a>
<a class="sourceLine" id="cb18-15" data-line-number="15">                                  <span class="st">&quot;_numTrees_&quot;</span>, numTree, <span class="st">&quot;.csv&quot;</span>)</a>
<a class="sourceLine" id="cb18-16" data-line-number="16">        curLoocvFile &lt;-<span class="st"> </span><span class="kw">file.path</span>(resultDir, helperLoocvFile)</a>
<a class="sourceLine" id="cb18-17" data-line-number="17">        <span class="kw">write.csv</span>(rf.loocv, curLoocvFile)</a>
<a class="sourceLine" id="cb18-18" data-line-number="18">        res &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">numTree =</span> rf.loocv)</a>
<a class="sourceLine" id="cb18-19" data-line-number="19">        <span class="kw">names</span>(res) &lt;-<span class="st"> </span><span class="kw">paste0</span>(numTree)</a>
<a class="sourceLine" id="cb18-20" data-line-number="20">        <span class="kw">return</span>(res)</a>
<a class="sourceLine" id="cb18-21" data-line-number="21">    }</a>
<a class="sourceLine" id="cb18-22" data-line-number="22">    svm.comb &lt;-<span class="st"> </span><span class="kw">foreach</span> (<span class="dt">kern =</span> kernels, <span class="dt">.combine =</span> <span class="st">&quot;c&quot;</span>) <span class="op">%do%</span><span class="st"> </span>{</a>
<a class="sourceLine" id="cb18-23" data-line-number="23">        svm.loocv &lt;-<span class="st"> </span><span class="kw">LOOCV</span>(SvmClassifier, kern, selData)</a>
<a class="sourceLine" id="cb18-24" data-line-number="24">        helperLoocvFile &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;SVM_loocv_Selection_&quot;</span>,</a>
<a class="sourceLine" id="cb18-25" data-line-number="25">                                  selection, <span class="st">&quot;_kernel_&quot;</span>, kern, <span class="st">&quot;.csv&quot;</span>)</a>
<a class="sourceLine" id="cb18-26" data-line-number="26">        curLoocvFile &lt;-<span class="st"> </span><span class="kw">file.path</span>(resultDir, helperLoocvFile)</a>
<a class="sourceLine" id="cb18-27" data-line-number="27">        <span class="kw">write.csv</span>(svm.loocv, curLoocvFile)</a>
<a class="sourceLine" id="cb18-28" data-line-number="28">        res &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">kern =</span> svm.loocv)</a>
<a class="sourceLine" id="cb18-29" data-line-number="29">        <span class="kw">names</span>(res) &lt;-<span class="st"> </span><span class="kw">paste0</span>(kern)</a>
<a class="sourceLine" id="cb18-30" data-line-number="30">        <span class="kw">return</span>(res)</a>
<a class="sourceLine" id="cb18-31" data-line-number="31">    }</a>
<a class="sourceLine" id="cb18-32" data-line-number="32">    svm.name &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;svm &quot;</span>, selection)</a>
<a class="sourceLine" id="cb18-33" data-line-number="33">    rf.name &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;rf &quot;</span>, selection)</a>
<a class="sourceLine" id="cb18-34" data-line-number="34">    res &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">rfRes =</span> rf.comb, <span class="dt">svmRes =</span> svm.comb)</a>
<a class="sourceLine" id="cb18-35" data-line-number="35">    <span class="kw">names</span>(res) &lt;-<span class="st"> </span><span class="kw">paste0</span>(selection, <span class="kw">names</span>(res))</a>
<a class="sourceLine" id="cb18-36" data-line-number="36">    <span class="kw">return</span>(res)</a>
<a class="sourceLine" id="cb18-37" data-line-number="37">}</a></code></pre></div>
</div>
<div id="evaluation" class="section level2">
<h2>Evaluation</h2>
<p>TODO</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1">response &lt;-<span class="st"> </span>phenoTable[, classVariable]</a>
<a class="sourceLine" id="cb19-2" data-line-number="2">response &lt;-<span class="st"> </span><span class="kw">factor</span>(response, <span class="dt">levels =</span> <span class="kw">rev</span>(<span class="kw">levels</span>(response)))</a>
<a class="sourceLine" id="cb19-3" data-line-number="3"><span class="kw">names</span>(response) &lt;-<span class="st"> </span><span class="kw">rownames</span>(phenoTable)</a>
<a class="sourceLine" id="cb19-4" data-line-number="4">evaluationResults &lt;-<span class="st"> </span><span class="kw">foreach</span>(<span class="dt">res =</span> resultList, <span class="dt">.combine =</span> <span class="st">&#39;rbind&#39;</span>) <span class="op">%do%</span><span class="st"> </span>{</a>
<a class="sourceLine" id="cb19-5" data-line-number="5">  check &lt;-<span class="st"> </span><span class="kw">names</span>(response) <span class="op">==</span><span class="st"> </span><span class="kw">names</span>(res)</a>
<a class="sourceLine" id="cb19-6" data-line-number="6">  <span class="kw">message</span>(<span class="st">&quot;Patients in Same Order:&quot;</span>)</a>
<a class="sourceLine" id="cb19-7" data-line-number="7">  <span class="kw">print</span>(<span class="kw">all</span>(check,<span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb19-8" data-line-number="8"> </a>
<a class="sourceLine" id="cb19-9" data-line-number="9">  tab &lt;-<span class="st"> </span><span class="kw">table</span>(res, response)</a>
<a class="sourceLine" id="cb19-10" data-line-number="10">  misclError &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">-</span><span class="kw">sum</span>(<span class="kw">diag</span>(tab))<span class="op">/</span><span class="kw">sum</span>(tab)</a>
<a class="sourceLine" id="cb19-11" data-line-number="11">  ci.upper &lt;-<span class="st"> </span>misclError <span class="op">+</span><span class="st"> </span><span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>( (misclError <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>misclError)) <span class="op">/</span><span class="st"> </span><span class="dv">190</span>)</a>
<a class="sourceLine" id="cb19-12" data-line-number="12">  ci.lower &lt;-<span class="st"> </span>misclError <span class="op">-</span><span class="st"> </span><span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>( (misclError <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>misclError)) <span class="op">/</span><span class="st"> </span><span class="dv">190</span>)</a>
<a class="sourceLine" id="cb19-13" data-line-number="13">  ci.interval &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="kw">round</span>(ci.lower,<span class="dv">4</span>), <span class="st">&quot;-&quot;</span>, <span class="kw">round</span>(ci.upper,<span class="dv">4</span>))</a>
<a class="sourceLine" id="cb19-14" data-line-number="14">  <span class="kw">message</span>(<span class="st">&quot;Misclassifiction Error for current predictions:&quot;</span>)</a>
<a class="sourceLine" id="cb19-15" data-line-number="15">  <span class="kw">message</span>(<span class="kw">round</span>(misclError,<span class="dv">4</span>))</a>
<a class="sourceLine" id="cb19-16" data-line-number="16">  <span class="kw">return</span>(<span class="kw">data.frame</span>(<span class="dt">MisclassificationError =</span> <span class="kw">round</span>(misclError,<span class="dv">4</span>), <span class="dt">CI =</span> ci.interval))</a>
<a class="sourceLine" id="cb19-17" data-line-number="17">}</a>
<a class="sourceLine" id="cb19-18" data-line-number="18"></a>
<a class="sourceLine" id="cb19-19" data-line-number="19"><span class="co">## make resulttable more beautiful</span></a>
<a class="sourceLine" id="cb19-20" data-line-number="20"></a>
<a class="sourceLine" id="cb19-21" data-line-number="21">helper &lt;-<span class="st"> </span>evaluationResults[<span class="dv">8</span><span class="op">:</span><span class="dv">14</span>,]</a>
<a class="sourceLine" id="cb19-22" data-line-number="22">parameters &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;RF 200 Trees&quot;</span>, </a>
<a class="sourceLine" id="cb19-23" data-line-number="23">                <span class="st">&quot;RF 500 Trees&quot;</span>, </a>
<a class="sourceLine" id="cb19-24" data-line-number="24">                <span class="st">&quot;RF 1000 Trees&quot;</span>, </a>
<a class="sourceLine" id="cb19-25" data-line-number="25">                <span class="st">&quot;SVM Radial Kernel&quot;</span>,</a>
<a class="sourceLine" id="cb19-26" data-line-number="26">                <span class="st">&quot;SVM Linear Kernel&quot;</span>,</a>
<a class="sourceLine" id="cb19-27" data-line-number="27">                <span class="st">&quot;SVM Ploynomial Kernel&quot;</span>,</a>
<a class="sourceLine" id="cb19-28" data-line-number="28">                <span class="st">&quot;SVM Sigmoid Kernel&quot;</span>)</a>
<a class="sourceLine" id="cb19-29" data-line-number="29"></a>
<a class="sourceLine" id="cb19-30" data-line-number="30">evaluationResults &lt;-<span class="st">  </span>evaluationResults[<span class="op">-</span>(<span class="dv">8</span><span class="op">:</span><span class="dv">14</span>),]</a>
<a class="sourceLine" id="cb19-31" data-line-number="31">evaluationResults &lt;-<span class="st"> </span><span class="kw">cbind</span>(evaluationResults, helper)</a>
<a class="sourceLine" id="cb19-32" data-line-number="32"><span class="kw">rownames</span>(evaluationResults) &lt;-<span class="st"> </span>parameters</a>
<a class="sourceLine" id="cb19-33" data-line-number="33"><span class="kw">colnames</span>(evaluationResults) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;All Genes&quot;</span>,</a>
<a class="sourceLine" id="cb19-34" data-line-number="34">                                 <span class="st">&quot;95% CI&quot;</span>,</a>
<a class="sourceLine" id="cb19-35" data-line-number="35">                                 <span class="st">&quot;48 Selected Genes&quot;</span>,</a>
<a class="sourceLine" id="cb19-36" data-line-number="36">                                 <span class="st">&quot;95% CI&quot;</span>)</a>
<a class="sourceLine" id="cb19-37" data-line-number="37"></a>
<a class="sourceLine" id="cb19-38" data-line-number="38"><span class="kw">kable</span>(evaluationResults)</a></code></pre></div>
<p>message(“Saving Image file”) message(paste(memImageFile)) save.image(memImageFile);</p>
</div>
<div id="interpretation" class="section level2">
<h2>Interpretation</h2>
<p>TODO</p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
